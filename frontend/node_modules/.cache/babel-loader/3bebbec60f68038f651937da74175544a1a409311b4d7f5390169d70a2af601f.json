{"ast":null,"code":"import{createContext,useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import api from'../services/api';import{toast}from'react-toastify';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[token,setToken]=useState(localStorage.getItem('token'));const[loading,setLoading]=useState(true);const navigate=useNavigate();const setAuthToken=token=>{if(token){api.defaults.headers.common['Authorization']=\"Bearer \".concat(token);localStorage.setItem('token',token);}else{delete api.defaults.headers.common['Authorization'];localStorage.removeItem('token');}};const login=async(email,password)=>{try{const{data}=await api.post('/auth/login',{email,password});setAuthToken(data.token);setUser(data.user);toast.success(\"Welcome back, \".concat(data.user.username,\"!\"));navigate('/');}catch(err){var _err$response,_err$response$data;toast.error(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'Login failed');throw err;}};const register=async userData=>{try{const{data}=await api.post('/auth/register',userData);setAuthToken(data.token);setUser(data.user);toast.success('Registration successful!');navigate('/');}catch(err){var _err$response2,_err$response2$data;toast.error(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.message)||'Registration failed');throw err;}};const logout=()=>{setAuthToken(null);setUser(null);toast.info('Logged out successfully');navigate('/login');};useEffect(()=>{const loadUser=async()=>{if(token){setAuthToken(token);try{const{data}=await api.get('/auth/me');setUser(data);}catch(err){logout();}}setLoading(false);};loadUser();},[token]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,token,loading,login,register,logout},children:children});};export default AuthContext;","map":{"version":3,"names":["createContext","useState","useEffect","useNavigate","api","toast","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","token","setToken","localStorage","getItem","loading","setLoading","navigate","setAuthToken","defaults","headers","common","concat","setItem","removeItem","login","email","password","data","post","success","username","err","_err$response","_err$response$data","error","response","message","register","userData","_err$response2","_err$response2$data","logout","info","loadUser","get","Provider","value"],"sources":["D:/freelance1/alps-crm/frontend/src/context/AuthContext.js"],"sourcesContent":["import { createContext, useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport api from '../services/api';\r\nimport { toast } from 'react-toastify';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n    const [user, setUser] = useState(null);\r\n    const [token, setToken] = useState(localStorage.getItem('token'));\r\n    const [loading, setLoading] = useState(true);\r\n    const navigate = useNavigate();\r\n\r\n    const setAuthToken = (token) => {\r\n        if (token) {\r\n            api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n            localStorage.setItem('token', token);\r\n        } else {\r\n            delete api.defaults.headers.common['Authorization'];\r\n            localStorage.removeItem('token');\r\n        }\r\n    };\r\n\r\n    const login = async (email, password) => {\r\n        try {\r\n            const { data } = await api.post('/auth/login', { email, password });\r\n            setAuthToken(data.token);\r\n            setUser(data.user);\r\n            toast.success(`Welcome back, ${data.user.username}!`);\r\n            navigate('/');\r\n        } catch (err) {\r\n            toast.error(err.response?.data?.message || 'Login failed');\r\n            throw err;\r\n        }\r\n    };\r\n\r\n    const register = async (userData) => {\r\n        try {\r\n            const { data } = await api.post('/auth/register', userData);\r\n            setAuthToken(data.token);\r\n            setUser(data.user);\r\n            toast.success('Registration successful!');\r\n            navigate('/');\r\n        } catch (err) {\r\n            toast.error(err.response?.data?.message || 'Registration failed');\r\n            throw err;\r\n        }\r\n    };\r\n\r\n    const logout = () => {\r\n        setAuthToken(null);\r\n        setUser(null);\r\n        toast.info('Logged out successfully');\r\n        navigate('/login');\r\n    };\r\n\r\n    useEffect(() => {\r\n        const loadUser = async () => {\r\n            if (token) {\r\n                setAuthToken(token);\r\n                try {\r\n                    const { data } = await api.get('/auth/me');\r\n                    setUser(data);\r\n                } catch (err) {\r\n                    logout();\r\n                }\r\n            }\r\n            setLoading(false);\r\n        };\r\n        loadUser();\r\n    }, [token]);\r\n\r\n    return (\r\n        <AuthContext.Provider value={{ user, token, loading, login, register, logout }}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n\r\nexport default AuthContext;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}